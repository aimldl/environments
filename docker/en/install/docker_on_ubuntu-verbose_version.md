* TODO: Reorganize this document.
  * docker_on_ubuntu.md is complete. Make the corresponding changes to this document.
* Rev.2: 2021-01-29 (Fri)
* Rev.1: 2020-08-12 (Wed)
* Draft: 2020-03-24 (Tue)

# How to Install Docker on Ubuntu (verbose version)

* This document is tested on Ubuntu 18.04.
* The concise version of this document is [How to Install Docker on Ubuntu](docker_on_ubuntu.md).

## Install Docker from the `apt` Repository

### Step 1. Update Software Repositories

```bash
$ sudo apt update
  ...
$
```

### Step 2. Uninstall Old Versions of Docker

```
$ sudo apt remove docker docker-engine docker.io
  ...
$
```

### Step 3. Install Docker

```output
$ sudo apt install -y docker.io
```

## Verify the installation

### Step 1. Simply check if the `docker` command works.

```
$ docker --version
Docker version 19.03.6, build 369ce74a3c
$
```

If the docker command does not work, something has gone wrong in the previous steps.

> Caution: the installation process is NOT complete. Follow through the post-installation steps to configure the Docker environment.

### Step 2. Run the hello-world Docker image to test if Docker Hub works.

* At this point, it is safe to assume the `docker` will run successfully on the machine. 
* Run the `hello-world` image to test Docker Hub or the official Docker repository.

At first, no image exists on this machine.

```
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
$
```

Running the following command

```bash
$ sudo docker run hello-world
```

will trigger docker to automatically download or pull the image from Docker Hub.

```bash
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete 
Digest: sha256:f9dfddf63636d84ef479d645ab5885156ae030f611a56f3a7ac7f2fdd86d7e4e
Status: Downloaded newer image for hello-world:latest
```

Subsequently, the hello-world message is generated by containerizing the pulled image and running it.

```bash
Hello from Docker!
This message shows that your installation appears to be working correctly.
```

More information follows on; Docker is kind!

```bash
To generate this message, Docker took the following steps:

  1. The Docker client contacted the Docker daemon.
  2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
     (amd64)
  3. The Docker daemon created a new container from that image which runs the
     executable that produces the output you are currently reading.
  4. The Docker daemon streamed that output to the Docker client, which sent it
     to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
$
```

Unlike the previous execution, the same command `sudo docker images` shows an image.

```
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              fce289e99eb9        14 months ago       1.84kB
$
```

### Step 3. (Optionally) Run a Ubuntu container

```bash
$ sudo docker run -it ubuntu bash
```

triggers to pull the `ubuntu:latest` Docker image from Docker Hub.

```bash
Unable to find image 'ubuntu:latest' locally
latest: Pulling from library/ubuntu
83ee3a23efb7: Pull complete 
db98fc6f11f0: Pull complete 
f611acd52c6c: Pull complete 
Digest: sha256:703218c0465075f4425e58fac086e09e1de5c340b12976ab9eb8ad26615c3715
Status: Downloaded newer image for ubuntu:latest
```

Note, by default, `ubuntu` pulls the latest ubuntu image `ubuntu:latest`.

```bash
root@ed7fc6a9b3de:/# 
```

* You have run `bash` in the command. So a Bash terminal is launched in the interactive mode.
* The Bash prompt `root@ed7fc6a9b3de:/#` indicates:
  * `root` is the user name,
  * `ed7fc6a9b3de` is the container ID,
  * `/` is your location; 
  * `#` also tells you have the root privilege. 

To double-check, check the user name.

```bash
root@ed7fc6a9b3de:/# id
uid=0(root) gid=0(root) groups=0(root)
root@ed7fc6a9b3de:/# 
```

Check the container ID.

```bash
$ docker ps
CONTAINER ID        IMAGE               COMMAND               ...               NAMES
ed7fc6a9b3de        ubuntu              "bash"                ...               ecstatic_sutherland
$
```

Notice the image ID is different.

```bash
$ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
ubuntu              latest              f63181f19b2f        8 days ago          72.9MB
hello-world         latest              bf756fb1ae65        13 months ago       13.3kB
$
```

The location is directory `/`.

```bash
root@ed7fc6a9b3de:/# ls
bin  boot  dev  etc  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@ed7fc6a9b3de:/#
```

## Take the post-installation steps for Linux

### Configure to use Docker without the `sudo` command

Configure Linux / Manage Docker as a non-root user

#### Step 1. Create the `docker` group.

```
$ sudo groupadd docker
```

#### Step 2. Add your user to the `docker` group.

```
$ sudo usermod -aG docker $USER
```

#### Step 3. Log out and log back in so that your group membership is re-evaluated.

Just closing the terminal and re-opening it doesn't work. If testing on a virtual machine, it may be necessary to restart the virtual machine for changes to take effect.



### Configure Docker to Start on Boot

The Docker service needs to be setup to run at startup. To do so, type in:

```output
$ sudo systemctl enable docker
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /lib/systemd/system/docker.service.
$
```

Most current Linux distributions (RHEL, CentOS, Fedora, Ubuntu 16.04 and higher) use **systemd** to manage which services start when the system boots. For Ubuntu 14.10 and below, use upstart in [the document](https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-nonroot-user).

### Let's double-check the configuration

Say the previous configuration not to use `sudo` fails after the reboot. Let's check each step one by one to fix the problem.

#### List all the groups

For

```
Step 1. Create the docker group
$ sudo groupadd docker
```

run the `groups` command to list all the groups.

```bash
$ groups
h2o_docker sudo docker
$
```

The `docker` group does exist. For details, refer to [How to List Groups in Linux](https://linuxize.com/post/how-to-list-groups-in-linux/).

#### List the groups that the current user belongs to

For

```
Step 2. Add your user to the `docker` group.
$ sudo usermod -aG docker $USER
```

run the `groups` command with the current user name

```bash
$ groups $USER
h2o_docker : h2o_docker sudo docker
$
```

The user name is `h2o_docker` and this user does belong to the group `docker`. For details, refer to [How to Check the User Group(s) an Ubuntu User Belongs To](https://vitux.com/how-to-check-the-user-groups-an-ubuntu-user-belongs-to/).

#### Check the rest of configurations

For the following two actions, 

```
Step 3. Log out and log back in so that your group membership is re-evaluated.

Configure Docker to Start on Boot
$ sudo systemctl enable docker
```

check the status of docker by running:

```bash
$ sudo systemctl status docker
[sudo] h2o_docker의 암호: 
● docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: active (running) since Wed 2020-08-12 10:08:34 KST; 5min ago
     Docs: https://docs.docker.com
 Main PID: 2006 (dockerd)
    Tasks: 18
   CGroup: /system.slice/docker.service
           └─2006 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

 8월 12 10:08:33 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:33.842297158+09:00" le
 8월 12 10:08:33 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:33.842341908+09:00" le
 8월 12 10:08:33 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:33.842374838+09:00" le
 8월 12 10:08:33 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:33.842755445+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:34.473487034+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:34.709750212+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:34.801052395+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:34.801309762+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 dockerd[2006]: time="2020-08-12T10:08:34.822477454+09:00" le
 8월 12 10:08:34 h2o-Alienware-Aurora-R6 systemd[1]: Started Docker Application Container Engine.
```

Docker is loaded and active. It's fine. Enter `q` to quit and get out of this.

#### What's the problem then?

I don't know.