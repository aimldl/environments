* Draft: 2020-06-08 (Mon)

# Create a Public/Private Key Pair

## Summary (of the Related article)

For details, refer to: [How To Set Up SSH Keys on Ubuntu 16.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys-on-ubuntu-1604), 2018-04-12, Hanif Jetha

### Step 1 — Create the RSA Key Pair 

```bash
$ ssh-keygen
```

### Step 2 — Copy the Public Key to Ubuntu Server

#### Option 1. Copying Public Key Using `ssh-copy-id`

```bash
$ ssh-copy-id username@remote_host
```

You must already have password-based SSH access to your server.  On the remote host, specify the user account that you have password SSH access to. This is the account to which your public SSH key will be copied.

#### Option 2. Copying Public Key Using SSH

$ cat ~/.ssh/id_rsa.pub | ssh username@remote_host "mkdir -p ~/.ssh && touch ~/.ssh/authorized_keys && chmod -R go= ~/.ssh && cat >> ~/.ssh/authorized_keys"

```
​```bash
```

```
$ ssh aimldl@123.456.7.890
```

```
aimldl@123.456.7.890's password: 
```

```
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-99-generic x86_64)
```

```
  ...
```

```
Last login: Mon Jan 20 09:25:37 2020
```

```
2020-06-08 (월) 11:26 (23th week)
```

```
(base) aimldl@GPU-Desktop:~$ 
```

```
​```bash
```

138

```
$ ssh-copy-id aimldl@123.456.7.890
```

139

```
The authenticity of host '123.456.7.890 (123.456.7.890)' can't be established.
```

140

```
ECDSA key fingerprint is SHA256:  ... .
```

141

```
Are you sure you want to continue connecting (yes/no)? ^C
```

142

```
/usr/bin/ssh-copy-id: WARNING: All keys were skipped because they already exist on the remote system.
```

143

```
                (if you think this is a mistake, you may want to use -f option)
```

144

```
$
```

145

```
​```
```

```

```

### Option 3. Copying Public Key Manually

```bash
# Local Machine
$ cat ~/.ssh/id_rsa.pub

# Remote-server
$ mkdir -p ~/.ssh
$ echo public_key_string >> ~/.ssh/authorized_keys
$ chmod -R go= ~/.ssh
$ chown -R sammy:sammy ~/.ssh
```

Manually append the content of your `id_rsa.pub` file to the `~/.ssh/authorized_keys` file on your remote machine.

## Step 3 — Authenticate to Ubuntu Server Using SSH Keys





For more information, google-search `ubuntu how to create public private key pair`

## Hands-on

### Step 1 — Create the RSA Key Pair 

The `ssh-keygen` creates both public and private keys.

```bash
$ ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/git/.ssh/id_rsa): 
Created directory '/home/git/.ssh'.
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/git/.ssh/id_rsa.
Your public key has been saved in /home/git/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:8Brf6SU1oa4/+/ThbrvvLHlRO8XkIy1KqikaKoOJ/zM git@GPU-Desktop
The key's randomart image is:
+---[RSA 2048]----+
|                 |
|                .|
|      .     . .+ |
|       o   o + o=|
|      . S + + o =|
|       + + + . + |
|o. .  . + = o ..o|
|* . E. o o.+ o+o.|
|.+.ooo. ..++.o*B+|
+----[SHA256]-----+
$
```

Entering passphrase is optional. I do not provide passphrase for convenience, though.

If a private key is created with passphrase, the passphrase is asked when you attempt to access a remote host with the private key.

```bash
$ ssh -i private_key-aimldl_GPU_DESKTOP.pem aimldl@123.456.7.890
Enter passphrase for key 'private_key-aimldl_GPU_DESKTOP.pem': 
```

Note my user account name is `git`. The above SHA256 and randommart image are an example generated by `ssh-keygen`. 

If there exists an existing key pair, a confirmation message is shown. Be careful when you overwrite the key pairs.

```bash
/home/git/.ssh/id_rsa already exists.
Overwrite (y/n)? y
```

```bash
$ ls ~/.ssh/
id_rsa  id_rsa.pub
$
```
* Public key: `id_rsa.pub`
```bash
ssh-rsa ...
  ... git@GPU-Desktop
```

* Private key: `id_rsa`
```bash
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,  ...
  ...
-----END RSA PRIVATE KEY-----
```
### Step 2 — Copy the Public Key to Ubuntu Server

Luckily, I have the remote host set up half a year ago. It works with password.

```bash
# On the local machine,
$ ssh aimldl@123.456.7.890
aimldl@123.456.7.890's password: 
Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-99-generic x86_64)
  ...
Last login: Mon Jan 20 09:25:37 2020
2020-06-08 (월) 11:26 (23th week)
(base) aimldl@GPU-Desktop:~$ 
```

Create a private key by copying & pasting the private key into a text file. In this example, the file name is `private_key-aimldl.pem`

```bash
$ nano private_key-aimldl.pem
$ ls
private_key-aimldl.pem
$
```

Change the permission of the file.

```bash
$ chmod 600 private_key-aimldl.pem
```

Otherwise, the following warning occurs when this private key is used.

```bash
$ ssh -i private_key-aimldl.pem aimldl@123.456.7.890
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for 'private_key-aimldl.pem' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "private_key-aimldl_GPU_DESKTOP.pem": bad permissions
```

#### Option 1. Copying Public Key Using `ssh-copy-id`

```bash
# On your local machine
$ ssh-copy-id username@remote_host
```

You must already have password-based SSH access to your server.  On the remote host, specify the user account that you have password SSH access to. This is the account to which your public SSH key will be copied.

Notice this command is to run on your local machine. If `ssh-copy-id` is ran on the remote host by accident, the following error message occurs.

```bash
$ ssh-copy-id aimldl@123.456.7.890
The authenticity of host '123.456.7.890 (123.456.7.890)' can't be established.
ECDSA key fingerprint is SHA256:  ... .
Are you sure you want to continue connecting (yes/no)? ^C
/usr/bin/ssh-copy-id: WARNING: All keys were skipped because they already exist on the remote system.
		(if you think this is a mistake, you may want to use -f option)
$
```

